#!/bin/sh
# Author: Andreas Louv <andreas@louv.dk>
# This script open dmenu with latest copied clipboards.
# Requires: clipbored

readonly pgm=${0##*/}
readonly last=50

choice=$(clipbored --last "$last" \
  | sed -E 's/^(.{25}).*(.{20})$/\1...\2/;$d' \
  | tac | dmenu -i)

choice_number=$(printf "%s" "$choice" | sed 's/^[^0-9]*\([0-9]*\).*$/\1/')

if [ "$choice_number" = "" ]; then
  >&2 printf "%s: no item selected\n" "$pgm"
  exit 2
fi

choice_number=$((choice_number + 1))

full_clipboard=$(clipbored --last "$last" \
  | sed -n "$choice_number"'{s/[^0-9]*[0-9]* //p;q}')

printf "%s" "$full_clipboard" | xclip -selection "${CLIPBORED_X_SELECTION:-primary}"
