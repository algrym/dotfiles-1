#!/bin/sh
# Author: Andreas Louv <andreas@louv.dk>
sitemule_root="/home/and/work/Sitemule"
project=${1:-"$(cd "$sitemule_root" || exit 1; git branch | sed 's/\* \(.*\)/\1/p;d')"}
port="$(SITEMULE_ROOT="$sitemule_root" sm_start "$project" --port-only 2> /dev/null)"

if [ -z "$port" ]; then
	>&2 echo "Cannot locate project"
	exit 1
fi;

i3_layout="${0%/*}/ow.json"

if i3-msg "append_layout $i3_layout"; then
	SITEMULE_ROOT="$sitemule_root" $TERMINAL -e "sm_start $project" &
	SITEMULE_ROOT="$sitemule_root" $TERMINAL -e "sm_open $project" &
	chromium --new-window "http://localhost:$port"
fi
