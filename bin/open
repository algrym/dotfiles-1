#!/bin/sh
# Author: Andreas Louv <andreas@louv.dk>
# This command will open a file either though your editor of choice or xdg-open
# It will look for the specified file in either the current working directory
# or in a directory specified in the 'CDPATH' environment variable

file=$1
file=$(printf ".\n%s" "$CDPATH" | tr ':' '\n' | while read -r dir; do
  if [ -e "$dir/$file" ]; then
    printf "%s/%s" "$dir" "$file"
    break
  fi
done)

if [ -z "$file" ]; then
  >&2 printf "$0: cannot access '%s': No such file or directory\n" "$1"
  exit 2
fi

if file -L -- "$file" | grep -q text; then
  "$EDITOR" "$file"
else
  xdg-open "$file"
fi
